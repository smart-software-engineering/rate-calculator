{{ define "partials/expense_category" }}
<div class="expense-category">
    <div class="category-header" onclick="toggleCategory('{{ .Category.ID }}')">
        <h3>{{ .Category.Label }}</h3>
        <div class="category-summary" id="category-summary-{{ .Category.ID }}">
            {{ template "partials/category_summary" . }}
        </div>
    </div>
    <div class="category-form hidden" id="category-{{ .Category.ID }}">
        <form hx-post="/update-category" hx-target="#result" hx-vals='{"category": "{{ .Category.ID }}"}'>
            <div class="category-items">
                {{ range .Category.Items }}
                <div class="expense-item">
                    <div class="form-group">
                        <label>{{ .Label }}</label>
                        <div class="input-group">
                            {{ if eq .Type "percentage" }}
                            <div class="slider-container">
                                <input
                                    type="range"
                                    name="expense[{{ .ID }}][amount]"
                                    value="{{ .Amount }}"
                                    min="0"
                                    max="100"
                                    step="1"
                                    class="percentage-slider"
                                    hx-trigger="change"
                                    hx-post="/update-category"
                                    hx-target="#result"
                                    hx-include="closest form"
                                >
                                <div class="slider-value">{{ .Amount }}%</div>
                            </div>
                            <input type="hidden" name="expense[{{ .ID }}][type]" value="percentage">
                            <input type="hidden" name="expense[{{ .ID }}][label]" value="{{ .Label }}">
                            {{ else }}
                            <input
                                type="number"
                                name="expense[{{ .ID }}][amount]"
                                value="{{ .Amount }}"
                                min="0"
                                step="0.01"
                                hx-trigger="change delay:500ms"
                                hx-post="/update-category"
                                hx-target="#result"
                                hx-include="closest form"
                            />
                            <select
                                name="expense[{{ .ID }}][type]"
                                hx-trigger="change"
                                hx-post="/update-category"
                                hx-target="#result"
                                hx-include="closest form"
                            >
                                <option value="monthly" {{ if eq .Type "monthly" }}selected{{ end }}>Monthly</option>
                                <option value="yearly" {{ if eq .Type "yearly" }}selected{{ end }}>Yearly</option>
                            </select>
                            <input type="hidden" name="expense[{{ .ID }}][label]" value="{{ .Label }}">
                            {{ end }}
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
        </form>
    </div>
</div>
{{ end }} 
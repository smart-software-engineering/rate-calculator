{{ define "partials/calculation_result" }}
<div id="calculation-result" class="calculation-result">
    <h2>Rate Calculation Results</h2>

    <div class="expenses-summary">
        <h3
            id="expenses-summary-header"
            class="collapsed"
            onclick="toggleExpensesDetail()"
        >
            Expenses Summary
        </h3>

        <div class="expenses-detail hidden" id="expenses-detail">
            <table class="expense-table">
                <thead>
                    <tr>
                        <th>Expense</th>
                        <th class="align-center">Percentage</th>
                        <th class="align-right">Monthly</th>
                        <th class="align-right">Yearly</th>
                    </tr>
                </thead>
                <tbody>
                    {{ $grandTotal := 0 }} {{ range .Expenses.Categories }}
                    <tr class="expense-category-header">
                        <td colspan="4">{{ .Label }}</td>
                    </tr>
                    {{ $categoryYearlyTotal := 0 }} {{ range .Items }}
                    <tr>
                        <td class="align-left">{{ .Label }}</td>
                        <td class="align-center">
                            {{ if eq .Type "percentage" }}{{ .Amount }}%{{ else
                            }}-{{ end }}
                        </td>
                        <td class="align-right">
                            {{ if eq .Type "monthly" }}{{ .Amount }}{{ else
                            }}-{{ end }}
                        </td>
                        <td class="align-right">
                            {{ if eq .Type "monthly" }}
                            <span class="yearly-calculated"
                                >{{ mul .Amount 12 }}</span
                            >
                            {{ $categoryYearlyTotal = add $categoryYearlyTotal
                            (mul .Amount 12) }} {{ else if eq .Type "yearly" }}
                            {{ .Amount }} {{ $categoryYearlyTotal = add
                            $categoryYearlyTotal .Amount }} {{ else if eq .Type
                            "percentage" }}
                            <span class="yearly-calculated"
                                >{{ div (mul $.TotalYearlyExpenses .Amount) 100
                                }}</span
                            >
                            {{ $categoryYearlyTotal = add $categoryYearlyTotal
                            (div (mul $.TotalYearlyExpenses .Amount) 100) }} {{
                            else }}-{{ end }}
                        </td>
                    </tr>
                    {{ end }}
                    <tr class="expense-category-total">
                        <td colspan="3">{{ .Label }} Total</td>
                        <td class="align-right">{{ $categoryYearlyTotal }}</td>
                    </tr>
                    {{ $grandTotal = add $grandTotal $categoryYearlyTotal }} {{
                    end }}
                </tbody>
            </table>
        </div>

        <div class="work-summary">
            <div class="summary-item">
                <span class="summary-label">Total Yearly Expenses:</span>
                <span class="summary-value">{{ .YearlyTotalWithPercent }}</span>
            </div>
        </div>
    </div>

    <div class="expenses-summary">
        <h3>Working Time Summary</h3>
        {{ template "partials/schedule_summary" . }}
    </div>

    <div class="expenses-summary">
        <h3>Rate Requirements</h3>
        <div class="work-summary">
            <div class="summary-item">
                <span class="summary-label">Recommended Hourly Rate:</span>
                <span class="summary-value">{{ .HourlyRate }}</span>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleExpensesDetail() {
        const header = document.getElementById("expenses-summary-header");
        const detail = document.getElementById("expenses-detail");

        header.classList.toggle("collapsed");
        detail.classList.toggle("hidden");
    }
</script>
{{ end }}
